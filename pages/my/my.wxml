<!--pages/my/my.wxml-->
<view class="my-container">
  <!-- 自定义导航栏 -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content" style="height: {{navBarHeight}}px;">
      <view class="navbar-title">我的</view>
    </view>
  </view>

  <scroll-view class="my-content" scroll-y>
    <!-- 用户信息卡片 -->
    <view class="user-card">
      <view class="user-header">
        <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
        <view class="user-info">
          <view class="user-name-row">
            <view class="user-name">{{userInfo.name}}</view>
            <view class="edit-btn" bindtap="editProfile">
              <image class="edit-icon" src="/assets/my/icon-edit.png" mode="aspectFit"></image>
            </view>
          </view>
          <view class="user-id">ID: {{userInfo.id}}</view>
        </view>
      </view>
      
      <!-- BMI信息 -->
      <view class="bmi-section">
        <view class="bmi-data">
          <view class="bmi-item">
            <text class="bmi-item-label">身高</text>
            <text class="bmi-item-value">{{userInfo.height}}cm</text>
          </view>
          <view class="bmi-divider"></view>
          <view class="bmi-item">
            <text class="bmi-item-label">体重</text>
            <text class="bmi-item-value">{{userInfo.weight}}kg</text>
          </view>
          <view class="bmi-divider"></view>
          <view class="bmi-item">
            <text class="bmi-item-label">BMI</text>
            <text class="bmi-item-value">{{userInfo.bmi}}</text>
          </view>
          <view class="bmi-divider"></view>
          <view class="bmi-item">
            <text class="bmi-item-label">状态</text>
            <text class="bmi-item-status {{userInfo.bmiStatus}}">{{userInfo.bmiText}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 健康目标 -->
    <view class="health-goal-card">
      <view class="card-header">
        <image class="card-icon" src="/assets/my/icon-goal.png" mode="aspectFit"></image>
        <text class="card-title">健康目标</text>
        <text class="card-target-bmi">目标BMI: {{healthGoal.targetBMI}}</text>
      </view>
      <view class="goal-content">
        <view class="goal-item">
          <text class="goal-label">当前目标</text>
          <text class="goal-value">{{healthGoal.target}}</text>
        </view>
        <view class="goal-item">
          <text class="goal-label">目标体重</text>
          <text class="goal-value">{{healthGoal.targetWeight}}kg</text>
        </view>
        <view class="goal-item">
          <text class="goal-label">每日热量</text>
          <text class="goal-value">{{healthGoal.dailyCalories}}千卡</text>
        </view>
      </view>
    </view>

    <!-- 快捷功能 -->
    <view class="function-section">
      <view class="function-item" bindtap="navigateTo" data-page="/pages/health-profile/health-profile">
        <view class="function-left">
          <image class="function-icon" src="/assets/my/icon-health.png" mode="aspectFit"></image>
          <text class="function-name">健康档案</text>
        </view>
        <image class="function-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
      </view>
      
      <view class="function-item" bindtap="navigateTo" data-page="/pages/diet-diary/diet-diary">
        <view class="function-left">
          <image class="function-icon" src="/assets/my/icon-diary.png" mode="aspectFit"></image>
          <text class="function-name">饮食日记</text>
        </view>
        <image class="function-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
      </view>
      
      <view class="function-item" bindtap="navigateTo" data-page="/pages/data-stats/data-stats">
        <view class="function-left">
          <image class="function-icon" src="/assets/my/icon-stats.png" mode="aspectFit"></image>
          <text class="function-name">数据统计</text>
        </view>
        <image class="function-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
      </view>
    </view>

    <!-- 我的内容 -->
    <view class="content-section">
      <view class="content-item" bindtap="navigateTo" data-page="/pages/my-collection/my-collection">
        <view class="content-left">
          <image class="content-icon" src="/assets/my/icon-collection.png" mode="aspectFit"></image>
          <text class="content-name">我的收藏</text>
        </view>
        <view class="content-right">
          <text class="content-count">{{myContent.collections}}</text>
          <image class="content-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
        </view>
      </view>
      
      <view class="content-item" bindtap="navigateTo" data-page="/pages/my-recipe/my-recipe">
        <view class="content-left">
          <image class="content-icon" src="/assets/my/icon-recipe.png" mode="aspectFit"></image>
          <text class="content-name">我的食谱</text>
        </view>
        <view class="content-right">
          <text class="content-count">{{myContent.recipes}}</text>
          <image class="content-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
        </view>
      </view>
    </view>

    <!-- 设置 -->
    <view class="settings-section">
      <view class="settings-item" bindtap="navigateTo" data-page="/pages/diet-preference/diet-preference">
        <view class="settings-left">
          <image class="settings-icon" src="/assets/my/icon-preference.png" mode="aspectFit"></image>
          <text class="settings-name">饮食偏好设置</text>
        </view>
        <image class="settings-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
      </view>
      
      <view class="settings-item" bindtap="navigateTo" data-page="/pages/account-security/account-security">
        <view class="settings-left">
          <image class="settings-icon" src="/assets/my/icon-security.png" mode="aspectFit"></image>
          <text class="settings-name">账号和安全</text>
        </view>
        <image class="settings-arrow" src="/assets/my/icon-arrow.png" mode="aspectFit"></image>
      </view>
    </view>

    <!-- 底部占位 -->
    <view class="bottom-placeholder"></view>
  </scroll-view>

  <!-- 编辑个人信息弹窗 -->
  <view class="modal-overlay" wx:if="{{showEditModal}}" bindtap="closeEditModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">编辑个人信息</text>
      </view>
      <view class="modal-body">
        <!-- 头像 -->
        <view class="form-item avatar-item">
          <view class="avatar-selector" bindtap="chooseAvatar">
            <image class="avatar-preview" src="{{tempAvatar}}" mode="aspectFill"></image>
            <text class="avatar-tip">点击更换头像</text>
          </view>
        </view>

        <!-- 昵称 -->
        <view class="form-item">
          <text class="form-label">昵称</text>
          <input 
            class="modal-input" 
            type="text" 
            placeholder="请输入昵称" 
            value="{{tempName}}"
            bindinput="onNameInput"
            maxlength="20"
          />
        </view>

        <!-- 身高体重 -->
        <view class="form-row">
          <view class="form-item-half">
            <text class="form-label">身高</text>
            <view class="input-with-unit">
              <input 
                class="modal-input-small" 
                type="digit" 
                placeholder="身高" 
                value="{{tempHeight}}"
                bindinput="onHeightInput"
                maxlength="3"
              />
              <text class="input-unit">cm</text>
            </view>
          </view>
          <view class="form-item-half">
            <text class="form-label">体重</text>
            <view class="input-with-unit">
              <input 
                class="modal-input-small" 
                type="digit" 
                placeholder="体重" 
                value="{{tempWeight}}"
                bindinput="onWeightInput"
                maxlength="5"
              />
              <text class="input-unit">kg</text>
            </view>
          </view>
        </view>

        <!-- 生日性别 -->
        <view class="form-row">
          <view class="form-item-half">
            <text class="form-label">生日</text>
            <picker 
              mode="date" 
              value="{{tempBirthday}}" 
              start="1950-01-01" 
              end="2020-12-31"
              bindchange="onBirthdayChange"
            >
              <view class="picker-input-small">
                <text class="picker-text-small">{{tempBirthday || '选择'}}</text>
              </view>
            </picker>
          </view>
          <view class="form-item-half">
            <text class="form-label">性别</text>
            <picker 
              mode="selector" 
              range="{{['男', '女']}}"
              value="{{tempGender}}"
              bindchange="onGenderChange"
            >
              <view class="picker-input-small">
                <text class="picker-text-small">{{tempGender === 0 ? '男' : '女'}}</text>
              </view>
            </picker>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="closeEditModal">
          <text>取消</text>
        </view>
        <view class="modal-btn confirm-btn" bindtap="confirmEdit">
          <text>确定</text>
        </view>
      </view>
    </view>
  </view>
</view>

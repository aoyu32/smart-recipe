<!--pages/diet-diary/diet-diary.wxml-->
<view class="diary-container">
  <!-- 自定义导航栏 -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content" style="height: {{navBarHeight}}px;">
      <view class="navbar-back" bindtap="goBack">
        <image class="back-icon" src="/assets/recipe-detail/icon-back.png" mode="aspectFit"></image>
      </view>
      <view class="navbar-title">饮食日记</view>
    </view>
  </view>

  <scroll-view class="diary-content" scroll-y>
    <!-- 日期选择器 -->
    <view class="date-selector">
      <view class="date-picker" bindtap="showDatePicker">
        <image class="calendar-icon" src="/assets/my/icon-diary.png" mode="aspectFit"></image>
        <text class="date-text">{{currentDate}}</text>
        <text class="weekday-text">{{currentWeekday}}</text>
      </view>
      <view class="date-nav">
        <view class="nav-btn" bindtap="prevDay">
          <text class="nav-arrow">‹</text>
        </view>
        <view class="nav-btn" bindtap="nextDay">
          <text class="nav-arrow">›</text>
        </view>
      </view>
    </view>

    <!-- 今日总摄入量 -->
    <view class="summary-card">
      <view class="summary-header">
        <text class="summary-title">今日总摄入</text>
        <text class="summary-status">{{checkedMealsCount}}/3餐已打卡</text>
      </view>
      <view class="summary-stats">
        <view class="stat-item">
          <text class="stat-value">{{currentRecord.totalCalories}}</text>
          <text class="stat-label">总热量(千卡)</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{currentRecord.totalProtein}}g</text>
          <text class="stat-label">蛋白质</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{currentRecord.totalCarbs}}g</text>
          <text class="stat-label">碳水</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{currentRecord.totalFat}}g</text>
          <text class="stat-label">脂肪</text>
        </view>
      </view>
    </view>

    <!-- 餐次列表 -->
    <view class="meals-list">
      <!-- 早餐 -->
      <view class="meal-card {{currentRecord.meals.breakfast.checked ? 'checked' : ''}}">
        <view class="meal-header">
          <view class="meal-header-left">
            <image class="meal-icon" src="/assets/index/icon-zaocan.png" mode="aspectFit"></image>
            <text class="meal-name">{{currentRecord.meals.breakfast.time}}</text>
          </view>
          <view class="meal-header-right">
            <text class="meal-calories">{{currentRecord.meals.breakfast.calories}}千卡</text>
            <image class="check-icon" src="/assets/diet-diary/{{currentRecord.meals.breakfast.checked ? 'icon-checked' : 'icon-unchecked'}}.png" mode="aspectFit"></image>
          </view>
        </view>
        <view class="meal-foods" wx:if="{{currentRecord.meals.breakfast.foods.length > 0}}">
          <view class="food-item" wx:for="{{currentRecord.meals.breakfast.foods}}" wx:key="id">
            <image class="food-image" src="{{item.image}}" mode="aspectFill"></image>
            <view class="food-info">
              <view class="food-name-row">
                <text class="food-name">{{item.name}}</text>
                <text class="food-amount">{{item.amount}}</text>
              </view>
              <view class="food-nutrients">
                <text class="nutrient-item">{{item.calories}}千卡</text>
                <text class="nutrient-item">蛋白{{item.protein}}g</text>
                <text class="nutrient-item">碳水{{item.carbs}}g</text>
                <text class="nutrient-item">脂肪{{item.fat}}g</text>
              </view>
            </view>
          </view>
        </view>
        <view class="empty-meal" wx:else>
          <text class="empty-text">暂无记录</text>
        </view>
      </view>

      <!-- 午餐 -->
      <view class="meal-card {{currentRecord.meals.lunch.checked ? 'checked' : ''}}">
        <view class="meal-header">
          <view class="meal-header-left">
            <image class="meal-icon" src="/assets/index/icon-wucan.png" mode="aspectFit"></image>
            <text class="meal-name">{{currentRecord.meals.lunch.time}}</text>
          </view>
          <view class="meal-header-right">
            <text class="meal-calories">{{currentRecord.meals.lunch.calories}}千卡</text>
            <image class="check-icon" src="/assets/diet-diary/{{currentRecord.meals.lunch.checked ? 'icon-checked' : 'icon-unchecked'}}.png" mode="aspectFit"></image>
          </view>
        </view>
        <view class="meal-foods" wx:if="{{currentRecord.meals.lunch.foods.length > 0}}">
          <view class="food-item" wx:for="{{currentRecord.meals.lunch.foods}}" wx:key="id">
            <image class="food-image" src="{{item.image}}" mode="aspectFill"></image>
            <view class="food-info">
              <view class="food-name-row">
                <text class="food-name">{{item.name}}</text>
                <text class="food-amount">{{item.amount}}</text>
              </view>
              <view class="food-nutrients">
                <text class="nutrient-item">{{item.calories}}千卡</text>
                <text class="nutrient-item">蛋白{{item.protein}}g</text>
                <text class="nutrient-item">碳水{{item.carbs}}g</text>
                <text class="nutrient-item">脂肪{{item.fat}}g</text>
              </view>
            </view>
          </view>
        </view>
        <view class="empty-meal" wx:else>
          <text class="empty-text">暂无记录</text>
        </view>
      </view>

      <!-- 晚餐 -->
      <view class="meal-card {{currentRecord.meals.dinner.checked ? 'checked' : ''}}">
        <view class="meal-header">
          <view class="meal-header-left">
            <image class="meal-icon" src="/assets/index/icon-wancan.png" mode="aspectFit"></image>
            <text class="meal-name">{{currentRecord.meals.dinner.time}}</text>
          </view>
          <view class="meal-header-right">
            <text class="meal-calories">{{currentRecord.meals.dinner.calories}}千卡</text>
            <image class="check-icon" src="/assets/diet-diary/{{currentRecord.meals.dinner.checked ? 'icon-checked' : 'icon-unchecked'}}.png" mode="aspectFit"></image>
          </view>
        </view>
        <view class="meal-foods" wx:if="{{currentRecord.meals.dinner.foods.length > 0}}">
          <view class="food-item" wx:for="{{currentRecord.meals.dinner.foods}}" wx:key="id">
            <image class="food-image" src="{{item.image}}" mode="aspectFill"></image>
            <view class="food-info">
              <view class="food-name-row">
                <text class="food-name">{{item.name}}</text>
                <text class="food-amount">{{item.amount}}</text>
              </view>
              <view class="food-nutrients">
                <text class="nutrient-item">{{item.calories}}千卡</text>
                <text class="nutrient-item">蛋白{{item.protein}}g</text>
                <text class="nutrient-item">碳水{{item.carbs}}g</text>
                <text class="nutrient-item">脂肪{{item.fat}}g</text>
              </view>
            </view>
          </view>
        </view>
        <view class="empty-meal" wx:else>
          <text class="empty-text">暂无记录</text>
        </view>
      </view>
    </view>

    <!-- 底部占位 -->
    <view class="bottom-placeholder"></view>
  </scroll-view>

  <!-- 日期选择弹窗 -->
  <view class="date-modal {{showDateModal ? 'show' : ''}}" bindtap="hideDatePicker">
    <view class="date-modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">选择日期</text>
        <view class="modal-close" bindtap="hideDatePicker">✕</view>
      </view>
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="date-picker-btn">
          <text>{{selectedDate}}</text>
        </view>
      </picker>
    </view>
  </view>
</view>
